vizlab: "0.1.7"
info:
  id: internal-analytics
  name: Internal analytics reporting
  date: 2017-04-03
  publish-date: 2099-01-01
  path: /analytics
  analytics-id: UA-78530187-1
  description: >-
    Internal reporting project to look at analytics data across the portfolio.
  thumbnail:
    url:
    width: 250
    height: 250
    alttext:
  required-packages:
    vizlab:
      repo: github
      version: 0.1.7
      name: USGS-VIZLAB/vizlab
      ref: v0.1.7
    dplyr:
      repo: CRAN
      version: 0.5.0
    googleAnalyticsR:
      repo: CRAN
      version: 0.5.1
    data.table:
      repo: CRAN
      version: 1.10.4
    sbtools:
      repo: CRAN
      version: 1.1.6
    assertthat:
      repo: CRAN
      version: 0.2.0
    ggplot2:
      repo: CRAN
      version: 2.2.1
    maps:
      repo: CRAN
      version: 3.1.1
    maptools:
      repo: CRAN
      version: 0.9-2
    sp:
      repo: CRAN
      version: 1.2-4
    rgeos:
      repo: CRAN
      version: 0.3-22
    rgdal:
      repo: CRAN
      version: 1.2-5
    tidyr:
      repo: CRAN
      version: 0.6.1
    googleAuthR:
      repo: CRAN
      version: 0.4.0
    lubridate:
      repo: CRAN
      version: 1.6.0
    yaml:
      repo: CRAN
      version: 2.1.14
    gridExtra:
      repo: CRAN
      version: 2.2.1
fetch:
  -
    id: fetchGA_cida
    login: cida #only fetch CIDA acct views
    fetcher: GAviews
    scripts: scripts/fetch/fetchGA.R
    location: cache/fetch/gaData.rds
    reader: rds
    remoteFilename: 'gaData.rds'
    remoteItemId: '58e56f3ce4b09da679997f7f' #'hybrid' fetcher, will check SB first
    update: FALSE #check for newer data from GA, and upload to sciencebase if there is
    useLocal: FALSE #Don't even download sciencebase file - overrides update
    depends: 
      project_table: project_table
  -
    id: fetchGA_nwis
    login: nwis
    fetcher: GAviews
    scripts: scripts/fetch/fetchGA.R
    location: cache/fetch/gaData_nwis.rds
    reader: rds
    remoteItemId: '58e56f3ce4b09da679997f7f'
    remoteFilename: 'gaData_nwis.rds'
    update: FALSE
    useLocal: FALSE
    depends:
      project_table: project_table
  -
    id: project_table
    fetcher: file
    location: data/ga_table.csv
    scripts:
    mimetype: text/csv
  -
    id: siteText
    location: data/siteText.yaml
    scripts:
    reader: md
    mimetype: text/yaml
process:
  -
    id: aggregate_ga
    processor: aggregate_ga
    scripts: scripts/process/aggregate.R
    depends: 
      cida: fetchGA_cida
      nwis: fetchGA_nwis
    reader: rds
    location: cache/process/aggregate_ga.rds
  -
    id: lastUpdated
    processor: lastUpdated
    location: cache/process/lastUpdated.yaml
    scripts: scripts/process/lastUpdated.R
    depends:
      data: aggregate_ga
    mimetype: text/yaml
    reader: md # need a better plain text reader
  -
    id: sessions_and_new_users
    processor: sessions_and_new_users 
    scripts: scripts/process/sessions_and_new_users.R
    depends: aggregate_ga
    reader: rds
    location: cache/process/sessions_and_new_users.rds
  -
    id: sessions_and_new_users_daily
    processor: sessions_and_new_users_daily 
    scripts: scripts/process/sessions_and_new_users_daily.R
    depends: aggregate_ga
    reader: rds
    location: cache/process/sessions_and_new_users_daily.rds
  -
    id: device_type
    processor: device_type 
    scripts: scripts/process/device_type.R
    depends: aggregate_ga
    reader: rds
    location: cache/process/device_type.rds
  -
    id: project_links
    processor: projectlinks
    scripts: ["scripts/process/projectlinks.R", "scripts/publish/utils.R"]
    depends: project_table
    reader: rds
    publisher: none
    location: cache/process/project_links.rds
  -
    id: source_counts
    processor: source_counts 
    scripts: scripts/process/source_counts.R
    depends: aggregate_ga
    rangetext: "-1 month"
    reader: rds
    location: cache/process/source_counts.rds
  -
    id: geo_apps
    processor: geo_apps 
    scripts: scripts/process/geo_apps.R
    depends: aggregate_ga
    rangetext: "-1 month"
    reader: rds
    location: cache/process/geo_apps.rds

visualize:
  -
    id: viz_month_sessions
    visualizer: viz_month_sessions 
    scripts: scripts/visualize/viz_month_sessions.R
    depends: sessions_and_new_users
    mimetype: text/csv
    height: 480
    width: 480
    location: cache/visualize/viz_month_sessions.csv
  -
    id: viz_y_sessions
    visualizer: viz_y_sessions 
    scripts: scripts/visualize/viz_y_sessions.R
    depends: sessions_and_new_users
    rangetext: "-1 year"
    plottype: year_line
    height: 300
    width: 1000
    mimetype: text/csv
    location: cache/visualize/viz_y_sessions.csv
  -
    id: viz_m_sessions
    visualizer: viz_y_sessions 
    scripts: scripts/visualize/viz_y_sessions.R
    depends: sessions_and_new_users
    rangetext: "-1 month"
    height: 300
    width: 1000
    plottype: month_line
    mimetype: text/csv
    location: cache/visualize/viz_m_sessions.csv
  -
    id: viz_w_sessions
    visualizer: viz_y_sessions 
    scripts: [scripts/visualize/viz_y_sessions.R]
    depends: sessions_and_new_users
    rangetext: "-1 week"
    height: 300
    width: 1000
    plottype: week_line
    mimetype: text/csv
    location: cache/visualize/viz_w_sessions.csv
  -
    id: viz_d_sessions
    visualizer: viz_d_sessions 
    scripts: scripts/visualize/viz_y_sessions.R
    depends: sessions_and_new_users_daily
    height: 300
    width: 1000
    plottype: day_line
    mimetype: text/csv
    location: cache/visualize/viz_d_sessions.csv
  -
    id: viz_geo_apps
    visualizer: viz_geo_apps 
    scripts: scripts/visualize/viz_geo_portfolio.R
    depends: geo_apps
    plottype: geo_month
    height: 2.25
    width: 3
    rangetext: "-1 month"
    mimetype: text/csv
    location: cache/visualize/viz_geo_apps.csv
  -
    id: timeDayUse_app
    visualizer: timeDayUse_app 
    scripts: scripts/visualize/timeDayUse.R
    depends: aggregate_ga
    plottype: app_hist
    rangetext: "-1 month"
    height: 480
    width: 480
    mimetype: text/csv
    location: cache/visualize/timeDayUse_apps.csv
  -
    id: timeDayUse_port
    visualizer: timeDayUse_all 
    scripts: scripts/visualize/timeDayUse.R
    depends: aggregate_ga
    plottype: app_hist
    height: 600
    width: 600
    mimetype: image/png
    alttext: "timeDayUse"
    title: "timeDayUse"
    location: figures/timeDayUse.png
  -
    id: viz_device_type
    visualizer: viz_device_type 
    scripts: scripts/visualize/viz_device_type.R
    depends: device_type
    height: 480
    width: 480
    rangetext: "-1 month"
    plottype: device_type
    mimetype: text/csv
    location: cache/visualize/viz_device_type.csv
  -
    id: viz_source
    visualizer: viz_source 
    scripts: scripts/visualize/viz_source.R
    height: 480
    width: 480
    depends: source_counts
    plottype: source_counts
    mimetype: text/csv
    location: cache/visualize/viz_source.csv
  -
    id: portfolio_sessions_all
    visualizer: portfolio_sessions_all 
    height: 8
    width: 10
    breaks: [10000, 100000, 1000000]
    scripts: scripts/visualize/portfolio_sessions_all.R
    depends: 
      sessions_and_new_users: sessions_and_new_users
      project_table: project_table
      sessions_and_new_users_daily: sessions_and_new_users_daily
    mimetype: image/png
    alttext: "Latest year sessions"
    title: "Latest year sessions"
    location: figures/portfolio_sessions_all.png
  -
    id: portfolio_time
    visualizer: portfolio_time 
    height: 500
    width: 500
    scripts: scripts/visualize/portfolio_time.R
    depends: 
      aggregate_ga: aggregate_ga
    mimetype: image/png
    alttext: "portfolio_time"
    title: "portfolio_time"
    location: figures/portfolio_time.png
  -
    id: app_time
    visualizer: app_time 
    height: 500
    width: 500
    rangetext: "-1 month"
    plottype: mean_time
    scripts: scripts/visualize/portfolio_time.R
    depends: 
      aggregate_ga: aggregate_ga
    mimetype: text/csv
    location: cache/visualize/viz_time.csv
  -
    id: portfolio_device_type
    visualizer: portfolio_device_type 
    height: 480
    width: 480
    scripts: scripts/visualize/portfolio_device_type.R
    depends: 
      device_type: device_type
    rangetext: "-1 month"
    mimetype: image/png
    alttext: "portfolio_device_type"
    title: "portfolio_device_type"
    location: figures/portfolio_device_type.png
  -
    id: portfolio_source
    visualizer: portfolio_source
    height: 480
    width: 480
    scripts: scripts/visualize/portfolio_source.R
    depends: 
      source_counts: source_counts
    rangetext: "-1 month"
    mimetype: image/png
    alttext: "portfolio_source"
    title: "portfolio_source"
    location: figures/portfolio_source.png
  -
    id: viz_geo_portfolio
    visualizer: viz_geo_portfolio 
    scripts: scripts/visualize/viz_geo_portfolio.R
    depends: geo_apps
    height: 2.25
    width: 3
    alttext: "viz_geo_portfolio"
    title: "viz_geo_portfolio"
    mimetype: image/png
    location: figures/viz_geo_portfolio.png
publish:
  -
    id: openSans
    publisher: googlefont
    family: Open Sans
    weight: [300, 400, 600]
  -
    id: internalAnalyticsCSS
    location: layout/css/internalAnalytics.css
    mimetype: text/css
    publisher: resource
  -
    id: detailsCSS
    location: layout/css/details.css
    mimetype: text/css
    publisher: resource
  -
    id: footerCSS
    location: layout/css/footer.css
    mimetype: text/css
    publisher: resource
  -
    id: usgsLogo
    location: images/usgsLogo.png
    mimetype: image/png
    title: "USGS"
    alttext: "USGS Logo"
  -
    id: missingImg
    location: "images/missing-01.png"
    mimetype: image/png
    title: "Missing"
    alttext: "Missing data"
  -
    id: index
    name: index
    publisher: page
    template: fullpage
    scripts: scripts/publish/
    depends:
      openSans: openSans
      header: header
      footer: footer
      frontPage: frontPage
      internalAnalyticsCSS: internalAnalyticsCSS
      detailsCSS: detailsCSS
      headerCSS: lib-header-css
      footerCSS : footerCSS
      jquery: jquery-js
    context:
      header: header
      footer: footer
      sections: ["frontPage"]
      resources: ["jquery", "openSans", "headerCSS", "footerCSS", "internalAnalyticsCSS", "detailsCSS"]
  -
    id: projectPages
    publisher: projectpage
    scripts: scripts/publish/
    template: layout/templates/details.mustache
    depends:
      header: header
      footer: footer
      siteText: siteText
      internalAnalyticsCSS: internalAnalyticsCSS
      headerCSS: lib-header-css
      detailsCSS: detailsCSS
      footerCSS : footerCSS
      jquery: jquery-js
      openSans: openSans
      project_table: project_table
      viz_month_sessions: viz_month_sessions
      viz_y_sessions: viz_y_sessions
      viz_m_sessions: viz_m_sessions
      viz_w_sessions: viz_w_sessions
      viz_d_sessions: viz_d_sessions
      viz_device_type: viz_device_type
      viz_source: viz_source
      viz_geo_apps: viz_geo_apps
      timeDayUse_app: timeDayUse_app
      sideBar: sideBar
      disclaimerGlossaryText: disclaimerGlossaryText
      app_time: app_time
    context:
      sideBar: sideBar
      disclaimerGlossaryText: disclaimerGlossaryText
      header: header
      footer: footer
      resources: ["jquery", "openSans", "headerCSS", "footerCSS", "internalAnalyticsCSS", "detailsCSS"]
  -
    id: project_list
    publisher: projectlist
    scripts: scripts/publish/
    template: layout/templates/projects.mustache
    depends: project_links
  -
    id: header
    publisher: section
    template: header-template
    context:
      title: Water Analytics - Portfolio Daily Summary
  -
    id: frontPage
    template: layout/templates/frontPage.mustache
    publisher: section
    scripts: scripts/publish/
    depends:
      siteText: siteText
      portfolio_sessions_all: portfolio_sessions_all
      portfolio_device_type: portfolio_device_type
      portfolio_source: portfolio_source
      viz_geo_portfolio: viz_geo_portfolio
      timeDayUse_port: timeDayUse_port
      sideBar: sideBar
      disclaimerGlossaryText: disclaimerGlossaryText
      portfolio_time: portfolio_time
    context:
      sideBar: sideBar
      disclaimerGlossaryText: disclaimerGlossaryText
      portfolio_sessions_all: portfolio_sessions_all
      portfolio_device_type: portfolio_device_type
      portfolio_source: portfolio_source
      viz_geo_portfolio: viz_geo_portfolio
      timeDayUse_port: timeDayUse_port
      portfolio_time: portfolio_time
  -
    id: sideBar
    publisher: section
    scripts: scripts/publish/
    template: layout/templates/sideBar.mustache
    depends:
      projects: project_list
    context:
      projects: projects
  -
    id: disclaimerGlossaryText
    publisher: section
    scripts: scripts/publish/
    template: layout/templates/text.mustache
    depends:
      siteText: siteText
    context:
      aboutThisReport: siteText.aboutThisReport
      disclaimerTitle: siteText.disclaimerTitle
      disclaimer1: siteText.disclaimer1
      disclaimer2: siteText.disclaimer2
      glossaryTitle: siteText.glossaryTitle
      session: siteText.session
      visitors: siteText.visitors
      geographical: siteText.geographical
      average: siteText.average
      traffic: siteText.traffic
      device: siteText.device
  -
    id: footer
    publisher: section
    template: layout/templates/footer.mustache
    depends: 
      usgsLogo: usgsLogo
      lastUpdatedGA: lastUpdated
    context:
      usgsLogo: usgsLogo
      lastUpdatedGA: lastUpdatedGA.time
  -
    id: jquery-js
    location: layout/js/jquery.min.js
    mimetype: text/javascript
  -
    id: app-js
    location: layout/js/app.js
    mimetype: text/javascript
