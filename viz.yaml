vizlab: "0.1.7"
info:
  id: internal-analytics
  name: Internal analytics reporting
  date: 2017-04-03
  publish-date: 2099-01-01
  path: /analytics
  analytics-id: UA-78530187-1
  description: >-
    Internal reporting project to look at analytics data across the portfolio.
  thumbnail:
    url:
    width: 250
    height: 250
    alttext:
  required-packages:
    vizlab:
      repo: github
      version: 0.1.7
      name: USGS-VIZLAB/vizlab
      ref: v0.1.7
    dplyr:
      repo: CRAN
      version: 0.5.0
    googleAnalyticsR:
      repo: CRAN
      version: 0.5.1
    data.table:
      repo: CRAN
      version: 1.10.4
    sbtools:
      repo: CRAN
      version: 1.1.6
    assertthat:
      repo: CRAN
      version: 0.2.0
    ggplot2:
      repo: CRAN
      version: 2.2.1
    maps:
      repo: CRAN
      version: 3.1.1
    googleAuthR:
      repo: CRAN
      version: 0.4.0
      
fetch:
  -
    id: fetchGA_cida
    login: cida #only fetch CIDA acct views
    fetcher: GAviews
    scripts: scripts/fetch/fetchGA.R
    location: cache/fetch/gaData.rds
    reader: rds
    remoteFilename: 'gaData.rds'
    remoteItemId: '58e56f3ce4b09da679997f7f' #'hybrid' fetcher, will check SB first
    update: TRUE #check for newer data from GA, and upload to sciencebase if there is
    useLocal: FALSE #Don't even download sciencebase file - overrides update
    depends: 
      project_table: project_table
  -
    id: fetchGA_nwis
    login: nwis
    fetcher: GAviews
    scripts: scripts/fetch/fetchGA.R
    location: cache/fetch/gaData_nwis.rds
    reader: rds
    remoteItemId: '58e56f3ce4b09da679997f7f'
    remoteFilename: 'gaData_nwis.rds'
    update: FALSE
    useLocal: TRUE
    depends:
      project_table: project_table
  -
    id: project_table
    fetcher: file
    location: data/ga_table.csv
    scripts:
    mimetype: text/csv
  -
    id: siteText
    location: data/siteText.yaml
    scripts:
    reader: md
    mimetype: text/yaml
process:
  -
    id: aggregate_ga
    processor: aggregate_ga
    scripts: scripts/process/aggregate.R
    depends: 
      cida: fetchGA_cida
      nwis: fetchGA_nwis
    reader: rds
    location: cache/process/aggregate_ga.rds
  -
    id: sessions_and_new_users
    processor: sessions_and_new_users 
    scripts: scripts/process/sessions_and_new_users.R
    depends: aggregate_ga
    reader: rds
    location: cache/process/sessions_and_new_users.rds
  -
    id: sessions_and_new_users_daily
    processor: sessions_and_new_users_daily 
    scripts: scripts/process/sessions_and_new_users_daily.R
    depends: aggregate_ga
    reader: rds
    location: cache/process/sessions_and_new_users_daily.rds
  -
    id: device_type
    processor: device_type 
    scripts: scripts/process/device_type.R
    depends: aggregate_ga
    reader: rds
    location: cache/process/device_type.rds
  -
    id: project_links
    processor: projectlinks
    scripts: ["scripts/process/projectlinks.R", "scripts/publish/utils.R"]
    depends: project_table
    reader: rds
    publisher: none
    location: cache/process/project_links.rds
  -
    id: source_counts
    processor: source_counts 
    scripts: scripts/process/source_counts.R
    depends: aggregate_ga
    rangetext: "-1 month"
    reader: rds
    location: cache/process/source_counts.rds
  -
    id: geo_apps
    processor: geo_apps 
    scripts: scripts/process/geo_apps.R
    depends: aggregate_ga
    rangetext: "-1 month"
    reader: rds
    location: cache/process/geo_apps.rds

visualize:
  -
    id: viz_month_sessions
    visualizer: viz_month_sessions 
    scripts: scripts/visualize/viz_month_sessions.R
    depends: sessions_and_new_users
    mimetype: text/csv
    height: 480
    width: 480
    location: cache/visualize/viz_month_sessions.csv
  -
    id: viz_y_sessions
    visualizer: viz_y_sessions 
    scripts: scripts/visualize/viz_y_sessions.R
    depends: sessions_and_new_users
    rangetext: "-1 year"
    plottype: year_line
    height: 200
    width: 600
    mimetype: text/csv
    location: cache/visualize/viz_y_sessions.csv
  -
    id: viz_m_sessions
    visualizer: viz_y_sessions 
    scripts: scripts/visualize/viz_y_sessions.R
    depends: sessions_and_new_users
    rangetext: "-1 month"
    height: 200
    width: 600
    plottype: month_line
    mimetype: text/csv
    location: cache/visualize/viz_m_sessions.csv
  -
    id: viz_w_sessions
    visualizer: viz_y_sessions 
    scripts: scripts/visualize/viz_y_sessions.R
    depends: sessions_and_new_users
    rangetext: "-1 week"
    height: 200
    width: 600
    plottype: week_line
    mimetype: text/csv
    location: cache/visualize/viz_w_sessions.csv
  -
    id: viz_d_sessions
    visualizer: viz_d_sessions 
    scripts: scripts/visualize/viz_d_sessions.R
    depends: sessions_and_new_users_daily
    height: 200
    width: 480
    plottype: day_line
    mimetype: text/csv
    location: cache/visualize/viz_d_sessions.csv
  -
    id: viz_geo_apps
    visualizer: viz_geo_apps 
    scripts: scripts/visualize/viz_geo_apps.R
    depends: geo_apps
    plottype: geo_month
    height: 3
    width: 3
    rangetext: "-1 month"
    mimetype: text/csv
    location: cache/visualize/viz_geo_apps.csv
  -
    id: viz_device_type
    visualizer: viz_device_type 
    scripts: scripts/visualize/viz_device_type.R
    depends: device_type
    height: 480
    width: 480
    rangetext: "-1 month"
    plottype: device_type
    mimetype: text/csv
    location: cache/visualize/viz_device_type.csv
  -
    id: viz_source
    visualizer: viz_source 
    scripts: scripts/visualize/viz_source.R
    height: 480
    width: 480
    depends: source_counts
    plottype: source_counts
    mimetype: text/csv
    location: cache/visualize/viz_source.csv
  -
    id: portfolio_year_sessions
    visualizer: portfolio_sessions 
    height: 480
    width: 200
    scripts: scripts/visualize/portfolio_sessions.R
    depends: 
      sessions_and_new_users: sessions_and_new_users
      project_table: project_table
    rangetext: "-1 year"
    mimetype: image/png
    alttext: "Latest year sessions"
    title: "Latest year sessions"
    location: figures/portfolio_year_sessions.png
  -
    id: portfolio_month_sessions
    visualizer: portfolio_sessions 
    height: 480
    width: 200
    scripts: scripts/visualize/portfolio_sessions.R
    depends: 
      sessions_and_new_users: sessions_and_new_users
      project_table: project_table
    rangetext: "-1 month"
    mimetype: image/png
    alttext: "Latest month sessions"
    title: "Latest month sessions"
    location: figures/portfolio_month_sessions.png
  -
    id: portfolio_week_sessions
    visualizer: portfolio_sessions 
    scripts: scripts/visualize/portfolio_sessions.R
    height: 480
    width: 200
    depends: 
      sessions_and_new_users: sessions_and_new_users
      project_table: project_table
    rangetext: "-1 week"
    mimetype: image/png
    alttext: "Latest week sessions"
    title: "Latest week sessions"
    location: figures/portfolio_week_sessions.png
  -
    id: portfolio_day_sessions
    visualizer: portfolio_sessions_day 
    height: 480
    width: 200
    scripts: scripts/visualize/portfolio_sessions_day.R
    depends: 
      sessions_and_new_users_daily: sessions_and_new_users_daily
      project_table: project_table
    rangetext: "-1 week"
    mimetype: image/png
    alttext: "Latest day sessions"
    title: "Latest day sessions"
    location: figures/portfolio_day_sessions.png
  -
    id: portfolio_device_type
    visualizer: portfolio_device_type 
    height: 480
    width: 480
    scripts: scripts/visualize/portfolio_device_type.R
    depends: 
      device_type: device_type
    rangetext: "-1 month"
    mimetype: image/png
    alttext: "portfolio_device_type"
    title: "portfolio_device_type"
    location: figures/portfolio_device_type.png
  -
    id: portfolio_source
    visualizer: portfolio_source
    height: 480
    width: 480
    scripts: scripts/visualize/portfolio_source.R
    depends: 
      source_counts: source_counts
    rangetext: "-1 month"
    mimetype: image/png
    alttext: "portfolio_source"
    title: "portfolio_source"
    location: figures/portfolio_source.png
  -
    id: viz_geo_portfolio
    visualizer: viz_geo_portfolio 
    scripts: scripts/visualize/viz_geo_portfolio.R
    depends: geo_apps
    height: 3
    width: 3
    alttext: "viz_geo_portfolio"
    title: "viz_geo_portfolio"
    mimetype: image/png
    location: figures/viz_geo_portfolio.png
publish:
  -
    id: openSans
    publisher: googlefont
    family: Open Sans
    weight: [300, 400, 600]
  -
    id: internalAnalyticsCSS
    location: layout/css/internalAnalytics.css
    mimetype: text/css
    publisher: resource
  -
    id: detailsCSS
    location: layout/css/details.css
    mimetype: text/css
    publisher: resource
  -
    id: footerCSS
    location: layout/css/footer.css
    mimetype: text/css
    publisher: resource
  -
    id: arrow
    location: images/arrow.svg
    mimetype: image/svg
    inline: true
    title: "Toggle"
    alttext: "Toggle Arrow"
  -
    id: usgsLogo
    location: images/usgsLogo.png
    mimetype: image/png
    title: "USGS"
    alttext: "USGS Logo"
  -
    id: missingImg
    location: "images/missing-01.png"
    mimetype: image/png
    title: "Missing"
    alttext: "Missing data"
  -
    id: index
    name: index
    publisher: page
    template: fullpage
    scripts: scripts/publish/
    depends:
      openSans: openSans
      header: header
      footer: footer
      frontPage: frontPage
      internalAnalyticsCSS: internalAnalyticsCSS
      detailsCSS: detailsCSS
      headerCSS: lib-header-css
      footerCSS : footerCSS
      jquery: jquery-js
      appJS: app-js
    context:
      header: header
      footer: footer
      sections: ["frontPage"]
      resources: ["jquery", "appJS", "openSans", "headerCSS", "footerCSS", "internalAnalyticsCSS", "detailsCSS"]
  -
    id: projectPages
    publisher: projectpage
    scripts: scripts/publish/
    template: layout/templates/details.mustache
    depends:
      header: header
      footer: footer
      arrow: arrow
      siteText: siteText
      projects: project_list
      internalAnalyticsCSS: internalAnalyticsCSS
      headerCSS: lib-header-css
      detailsCSS: detailsCSS
      footerCSS : footerCSS
      jquery: jquery-js
      appJS: app-js
      openSans: openSans
      project_table: project_table
      viz_month_sessions: viz_month_sessions
      viz_y_sessions: viz_y_sessions
      viz_m_sessions: viz_m_sessions
      viz_w_sessions: viz_w_sessions
      viz_d_sessions: viz_d_sessions
      viz_device_type: viz_device_type
      viz_source: viz_source
      viz_geo_apps: viz_geo_apps
    context:
      arrow: arrow
      projects: projects
      aboutThisReport: siteText.aboutThisReport
      disclaimerTitle: siteText.disclaimerTitle
      disclaimer1: siteText.disclaimer1
      disclaimer2: siteText.disclaimer2
      glossaryTitle: siteText.glossaryTitle
      session: siteText.session
      visitors: siteText.visitors
      geographical: siteText.geographical
      average: siteText.average
      traffic: siteText.traffic
      device: siteText.device
      header: header
      footer: footer
      resources: ["jquery", "appJS", "openSans", "headerCSS", "footerCSS", "internalAnalyticsCSS", "detailsCSS"]
  -
    id: project_list
    publisher: projectlist
    scripts: scripts/publish/
    template: layout/templates/projects.mustache
    depends: project_links
  -
    id: header
    publisher: section
    template: header-template
    context:
      title: Water Analytics - Portfolio Daily Summary
  -
    id: frontPage
    template: layout/templates/frontPage.mustache
    publisher: section
    scripts: scripts/publish/
    depends:
      arrow: arrow
      siteText: siteText
      projects: project_list
      portfolio_year_sessions: portfolio_year_sessions
      portfolio_month_sessions: portfolio_month_sessions
      portfolio_week_sessions: portfolio_week_sessions
      portfolio_day_sessions: portfolio_day_sessions
      portfolio_device_type: portfolio_device_type
      portfolio_source: portfolio_source
      viz_geo_portfolio: viz_geo_portfolio
    context:
      arrow: arrow
      aboutThisReport: siteText.aboutThisReport
      disclaimerTitle: siteText.disclaimerTitle
      disclaimer1: siteText.disclaimer1
      disclaimer2: siteText.disclaimer2
      glossaryTitle: siteText.glossaryTitle
      session: siteText.session
      visitors: siteText.visitors
      geographical: siteText.geographical
      average: siteText.average
      traffic: siteText.traffic
      device: siteText.device
      projects: projects
      portfolio_year_sessions: portfolio_year_sessions
      portfolio_month_sessions: portfolio_month_sessions
      portfolio_week_sessions: portfolio_week_sessions
      portfolio_day_sessions: portfolio_day_sessions
      portfolio_device_type: portfolio_device_type
      portfolio_source: portfolio_source
      viz_geo_portfolio: viz_geo_portfolio
  -
    id: footer
    publisher: section
    template: layout/templates/footer.mustache
    depends: 
      usgsLogo: usgsLogo
    context:
      usgsLogo: usgsLogo
  -
    id: jquery-js
    location: layout/js/jquery.min.js
    mimetype: text/javascript
  -
    id: app-js
    location: layout/js/app.js
    mimetype: text/javascript
